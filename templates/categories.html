{% extends "base.html" %}

{% block title %}Categorías{% endblock %}

{% block extra_css %}
<style>
    .category-color {
        width: 15px;
        height: 15px;
        display: inline-block;
        border-radius: 50%;
        margin-right: 5px;
        border: 1px solid #ddd;
    }

    /* Responsive table */
    @media (max-width: 767.98px) {
        .header-actions {
            flex-direction: column;
            align-items: flex-start !important;
        }

        .header-actions .btn {
            width: 100%;
            margin-top: 15px;
        }

        .table-responsive {
            border: 0;
        }

        .table thead {
            display: none;
        }

        .table,
        .table tbody,
        .table tr,
        .table td {
            display: block;
            width: 100%;
        }

        .table tr {
            margin-bottom: 20px;
            border: 1px solid #dee2e6;
            border-radius: 12px;
            padding: 10px;
            position: relative;
            background: #fff;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.02);
        }

        .table td {
            text-align: right;
            padding: 12px 10px 12px 45%;
            position: relative;
            border-top: 1px solid #f1f1f1;
            min-height: 45px;
        }

        .table td:first-child {
            border-top: 0;
            background: #f8f9fa;
            border-radius: 12px 12px 0 0;
            margin: -10px -10px 10px -10px;
            padding: 12px;
            text-align: center;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .table td:before {
            content: attr(data-label);
            position: absolute;
            left: 10px;
            width: 40%;
            padding-right: 10px;
            text-align: left;
            font-weight: 700;
            color: #6c757d;
            font-size: 0.85rem;
            text-transform: uppercase;
        }

        .table td:first-child:before {
            content: none;
        }

        .btn-group {
            display: flex;
            width: 100%;
        }

        .btn-group .btn {
            flex: 1;
            margin-top: 0 !important;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="row mb-4 header-actions align-items-center mt-4">
    <div class="col-md-6">
        <h2 class="fw-bold mb-0"><i class="fas fa-tags text-primary me-2"></i>Categorías</h2>
        <p class="text-muted small mb-0">Gestiona los temas de tu repositorio de conocimientos</p>
    </div>
    <div class="col-md-6 text-md-end text-start">
        <a href="{{ url_for('categories.create_category') }}" class="btn btn-primary rounded-pill px-4">
            <i class="fas fa-plus me-1"></i> Nueva Categoría
        </a>
    </div>
</div>

<div class="table-responsive">
    <table class="table table-hover align-middle">
        <thead class="table-light">
            <tr>
                <th>Nombre</th>
                <th>Representación</th>
                <th class="text-center">Notas</th>
                <th class="text-end">Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for category in categories %}
            <tr>
                <td data-label="Nombre" class="fw-bold">
                    {% if category.icon %}
                    <i class="{{ category.icon }} me-2 text-muted"></i>
                    {% else %}
                    <i class="fas fa-tag me-2 text-muted"></i>
                    {% endif %}
                    {{ category.name }}
                </td>
                <td data-label="Representación">
                    <span class="category-color" style="background-color: {{ category.color }};"></span>
                    <code>{{ category.color }}</code>
                </td>
                <td data-label="Notas" class="text-md-center">
                    <span class="badge bg-info rounded-pill px-3">
                        {{ category.notes|length }}
                    </span>
                </td>
                <td data-label="Acciones" class="text-md-end">
                    <div class="btn-group">
                        <a href="{{ url_for('categories.edit_category', category_id=category.id) }}"
                            class="btn btn-outline-secondary btn-sm" title="Editar">
                            <i class="fas fa-edit"></i>
                        </a>
                        <form action="{{ url_for('categories.delete_category', category_id=category.id) }}"
                            method="POST" class="d-inline"
                            onsubmit="return confirm('¿Estás seguro? Esta categoría debe estar vacía.');">
                            <button type="submit" class="btn btn-outline-danger btn-sm" title="Eliminar">
                                <i class="fas fa-trash"></i>
                            </button>
                        </form>
                    </div>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="4" class="text-center py-5">
                    <div class="text-muted">
                        <i class="fas fa-folder-open fa-3x mb-3 text-light"></i>
                        <p>No se encontraron categorías. <a href="{{ url_for('categories.create_category') }}">¡Crea la
                                primera!</a></p>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}